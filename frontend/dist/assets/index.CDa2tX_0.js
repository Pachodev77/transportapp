const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login.mc6rHNb8.js","assets/vendor-react.CmGka2D2.js","assets/vendor.C5NWDL7J.js","assets/vendor-leaflet.DZO0XrE_.js","assets/vendor-leaflet.Dgihpmma.css","assets/vendor-firebase.Cn81kGj9.js","assets/LandingPage.D5P-A-qm.js","assets/Passenger.BdG7N9e5.js","assets/Driver.B3XppC9J.js"])))=>i.map(i=>d[i]);
import{r as f,j as e,u as A,N as L,R as j,a as ce,L as g,F as le,b as H,c as K,d as de,e as ue,B as me,f as pe,g as k}from"./vendor-react.CmGka2D2.js";import{i as he,g as xe,a as fe,G as ge,F as be,c as z,s as ye,b as ve,e as we,q as V,w as C,o as G,d as re,f as je,h as E,j as W,k as te,u as B,l as Ne,m as Ee,n as ke,p as Y,r as Q,t as X,v as Le,x as Pe,y as Re}from"./vendor-firebase.Cn81kGj9.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const Se="modulepreload",Ce=function(r){return"/"+r},Z={},I=function(n,s,t){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(x=>{if(x=Ce(x),x in Z)return;Z[x]=!0;const y=x.endsWith(".css"),_=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${_}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":Se,y||(v.as="script"),v.crossOrigin="",v.href=x,h&&v.setAttribute("nonce",h),document.head.appendChild(v),y)return new Promise((T,q)=>{v.addEventListener("load",T),v.addEventListener("error",()=>q(new Error(`Unable to preload CSS for ${x}`)))})}))}function i(l){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l}return a.then(l=>{for(const h of l||[])h.status==="rejected"&&i(h.reason);return n().catch(i)})},Ae={apiKey:"AIzaSyBwff9ZSIOE8hF3c0-kKxX7zyj8MpO0C6E",authDomain:"transportapp-dfd34.firebaseapp.com",projectId:"transportapp-dfd34",storageBucket:"transportapp-dfd34.appspot.com",messagingSenderId:"81243763076",appId:"1:81243763076:web:7e0e3baca62282b0476dd1",measurementId:"G-HQ0VQ56HPB"},se=he(Ae),w=xe(se),Ie=async()=>{try{await ye(w,ve),await we(b,{forceOwnership:!0}),console.log("Firestore persistence enabled")}catch(r){r.code==="failed-precondition"?console.warn("Multiple tabs open, persistence can only be enabled in one tab at a time."):r.code==="unimplemented"&&console.warn("The current browser does not support all of the features required to enable persistence"),console.error("Persistence error:",r)}},b=fe(se),ae=new ge;ae.setCustomParameters({prompt:"select_account",login_hint:"user@example.com"});const oe=new be;oe.setCustomParameters({display:"popup",auth_type:"reauthenticate"});z(b,"users");const U=z(b,"trips");z(b,"bookings");const Ue=1e3;let J=0;const D=()=>{const r=Date.now();if(r-J<Ue)throw new Error("Rate limit exceeded. Please try again later.");J=r},N=async(r,n,s=!0)=>{try{D();const t=E(b,"users",r),a=W(),i={...n,updatedAt:a,...!n.createdAt&&{createdAt:a}};return await te(t,i,{merge:s}),{id:r,...i}}catch(t){throw console.error("Error updating user:",t),t}},He=async r=>{try{D();const n=E(U),s=W(),t={...r,status:"searching",createdAt:s,updatedAt:s};return await te(n,t),{id:n.id,...t}}catch(n){throw console.error("Error creating trip:",n),n}},Ke=(r,n,s=[])=>{try{const t=V(U,C("status","==",r),G("createdAt","desc"));return re(t,a=>{const i=a.docs.map(l=>{const h=l.data();return s.length>0?{id:l.id,...s.reduce((x,y)=>(h[y]!==void 0&&(x[y]=h[y]),x),{})}:{id:l.id,...h}});n(i)})}catch(t){throw console.error("Error subscribing to trips:",t),t}},Ye=async(r,n,s={})=>{try{D();const t=E(b,"trips",r),a={status:n,updatedAt:W(),...s};return await B(t,a),{id:r,...a}}catch(t){throw console.error("Error updating trip status:",t),t}},Qe=async(r,n=!1)=>{try{D();const s=n?"==":"!=",t=V(U,C("driverId","==",r),C("status",s,"completed"),G("createdAt","desc"));return(await je(t)).docs.map(l=>({id:l.id,...l.data()}))}catch(s){throw console.error("Error getting user trips:",s),s}},Xe=(r,n)=>{try{const s=V(U,C("driverId","==",r),G("createdAt","desc"));return re(s,t=>{const a=t.docs.map(i=>({id:i.id,...i.data()}));n(a)})}catch(s){throw console.error("Error subscribing to trip updates:",s),s}},ne=f.createContext();function O(){return f.useContext(ne)}function De({children:r}){const[n,s]=f.useState(null),[t,a]=f.useState(!0),[i,l]=f.useState(null),h=f.useCallback(async(c,o,d,p="passenger")=>{try{a(!0),l(null);const m=await Ne(w,c,o),{user:u}=m;return await Ee(u,{displayName:d,photoURL:u.photoURL||""}),await N(u.uid,{email:u.email,displayName:d,role:p,photoURL:u.photoURL||"",provider:"email",createdAt:new Date().toISOString()}),m}catch(m){console.error("Error al registrar usuario:",m);let u="Error al registrar el usuario";switch(m.code){case"auth/email-already-in-use":u="El correo electrónico ya está en uso";break;case"auth/invalid-email":u="El correo electrónico no es válido";break;case"auth/weak-password":u="La contraseña es demasiado débil";break;case"auth/operation-not-allowed":u="La operación no está permitida";break;default:u=m.message||u}throw l(u),new Error(u)}finally{a(!1)}},[]),x=f.useCallback(async(c,o)=>{var d;try{a(!0),l(null);const p=await ke(w,c,o);return(d=p==null?void 0:p.user)!=null&&d.uid&&await B(E(b,"users",p.user.uid),{lastLogin:new Date().toISOString()}),p}catch(p){console.error("Error al iniciar sesión:",p);let m="Error al iniciar sesión";switch(p.code){case"auth/user-not-found":case"auth/wrong-password":m="Correo o contraseña incorrectos";break;case"auth/too-many-requests":m="Demasiados intentos fallidos. Por favor, inténtalo más tarde";break;case"auth/user-disabled":m="Esta cuenta ha sido deshabilitada";break;default:m=p.message||m}throw l(m),new Error(m)}finally{a(!1)}},[]),y=f.useCallback(async()=>{try{const c=await Y(w,ae,Q),{user:o}=c;return o&&await N(o.uid,{email:o.email,displayName:o.displayName,photoURL:o.photoURL,role:"passenger",provider:"google.com",lastLogin:new Date().toISOString()}),c}catch(c){console.error("Error al iniciar sesión con Google:",c);let o="Error al iniciar sesión con Google";switch(c.code){case"auth/account-exists-with-different-credential":o="Ya existe una cuenta con el mismo correo pero con otro proveedor";break;case"auth/popup-closed-by-user":o="La ventana de autenticación fue cerrada";break;case"auth/cancelled-popup-request":o="Solicitud de autenticación cancelada";break;case"auth/popup-blocked":o="El navegador bloqueó la ventana emergente. Por favor, permite ventanas emergentes para este sitio";break;default:o=c.message||o}throw new Error(o)}},[N]),_=f.useCallback(async()=>{try{const c=await Y(w,oe,Q),{user:o}=c;return o&&await N(o.uid,{email:o.email,displayName:o.displayName,photoURL:o.photoURL,role:"passenger",provider:"facebook.com",lastLogin:new Date().toISOString()}),c}catch(c){console.error("Error al iniciar sesión con Facebook:",c);let o="Error al iniciar sesión con Facebook";switch(c.code){case"auth/account-exists-with-different-credential":o="Ya existe una cuenta con el mismo correo pero con otro proveedor";break;case"auth/popup-closed-by-user":o="La ventana de autenticación fue cerrada";break;case"auth/cancelled-popup-request":o="Solicitud de autenticación cancelada";break;case"auth/popup-blocked":o="El navegador bloqueó la ventana emergente. Por favor, permite ventanas emergentes para este sitio";break;case"auth/facebook-auth-already-in-use":o="Esta cuenta de Facebook ya está en uso";break;default:o=c.message||o}throw new Error(o)}},[N]),v=()=>Re(w),T=c=>Pe(w,c),q=f.useCallback(()=>{l(null)},[]),$=f.useCallback(async c=>{var p,m;if(!c)return null;const o=3;let d=0;for(;d<o;)try{return(await X(E(b,"users",c.uid))).exists()?await B(E(b,"users",c.uid),{lastLogin:new Date().toISOString()}):await N(c.uid,{email:c.email,displayName:c.displayName||"Usuario",photoURL:c.photoURL||"",role:"passenger",provider:((m=(p=c.providerData)==null?void 0:p[0])==null?void 0:m.providerId)||"email",lastLogin:new Date().toISOString(),createdAt:new Date().toISOString()}),c}catch(u){if(console.error(`Error en verificación de usuario (intento ${d+1}):`,u),d++,d<o)await new Promise(P=>setTimeout(P,1e3*Math.pow(2,d)));else throw console.error("Número máximo de reintentos alcanzado para verificación de usuario"),u}},[N,b]);f.useEffect(()=>{let c=!0;const o=Le(w,async d=>{var p,m,u,P;try{if(d){await $(d);const R=await X(E(b,"users",d.uid));if(R.exists()){const F=R.data();s({uid:d.uid,email:d.email,displayName:d.displayName||F.displayName,photoURL:d.photoURL||F.photoURL,role:F.role||"passenger",provider:((m=(p=d.providerData)==null?void 0:p[0])==null?void 0:m.providerId)||"email"})}else s({uid:d.uid,email:d.email,displayName:d.displayName||"Usuario",photoURL:d.photoURL||"",role:"passenger",provider:((P=(u=d.providerData)==null?void 0:u[0])==null?void 0:P.providerId)||"email"})}else s(null)}catch(R){console.error("Error al verificar el estado de autenticación:",R),l("Error al cargar la información del usuario")}finally{c&&a(!1)}});return()=>{c=!1,o()}},[$]);const ie={currentUser:n,signup:h,login:x,loginWithGoogle:y,loginWithFacebook:_,logout:v,resetPassword:T,loading:t,error:i,clearError:q};return e.jsx(ne.Provider,{value:ie,children:!t&&r})}function M({children:r,roles:n=[]}){const{currentUser:s,loading:t}=O(),a=A();if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando..."})]})});if(!s)return e.jsx(L,{to:"/login",state:{from:a},replace:!0});if(n.length>0){const i=s.role||"passenger";if(!n.includes(i))return e.jsx(L,{to:"/",replace:!0})}return r}function Oe(){const{currentUser:r,logout:n}=O(),[s,t]=j.useState(!1),a=ce(),i=async()=>{try{await n(),a("/")}catch(l){console.error("Error al cerrar sesión:",l)}};return e.jsxs("nav",{className:"bg-white shadow-lg",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(g,{to:"/",className:"flex-shrink-0 flex items-center",children:[e.jsx(le,{className:"h-8 w-8 text-blue-600"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"TransportApp"})]}),e.jsxs("div",{className:"hidden md:ml-6 md:flex md:space-x-8",children:[e.jsx(g,{to:"/",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Inicio"}),r&&e.jsx(g,{to:r.role==="driver"?"/driver":"/passenger",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:r.role==="driver"?"Mis Viajes":"Buscar Viaje"})]})]}),e.jsx("div",{className:"hidden md:ml-6 md:flex md:items-center",children:r?e.jsx("div",{className:"ml-3 relative",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Hola, ",r.displayName||r.email]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>t(!s),children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-700",children:e.jsx(H,{className:"h-5 w-5"})})}),s&&e.jsxs("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50",children:[e.jsx(g,{to:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>t(!1),children:"Mi perfil"}),e.jsxs("button",{onClick:i,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Cerrar sesión"]})]})]})]})}):e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{to:"/login",className:"text-gray-700 hover:text-blue-600 px-3 py-2 text-sm font-medium",state:{from:window.location.pathname},children:"Iniciar sesión"}),e.jsx(g,{to:"/login",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",state:{from:window.location.pathname,register:!0},children:"Registrarse"})]})}),e.jsx("div",{className:"-mr-2 flex items-center md:hidden",children:e.jsxs("button",{onClick:()=>t(!s),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",children:[e.jsx("span",{className:"sr-only",children:"Abrir menú principal"}),e.jsx(de,{className:"block h-6 w-6"})]})})]})}),s&&e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"pt-2 pb-3 space-y-1",children:[e.jsx(g,{to:"/",className:"border-transparent text-gray-600 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium",onClick:()=>t(!1),children:"Inicio"}),r&&e.jsx(g,{to:r.role==="driver"?"/driver":"/passenger",className:"border-transparent text-gray-600 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium",onClick:()=>t(!1),children:r.role==="driver"?"Mis Viajes":"Buscar Viaje"})]}),e.jsxs("div",{className:"pt-4 pb-3 border-t border-gray-200",children:[r?e.jsxs("div",{className:"flex items-center px-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-700",children:e.jsx(H,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-base font-medium text-gray-800",children:r.displayName||r.email}),e.jsx("div",{className:"text-sm font-medium text-gray-500",children:r.role==="driver"?"Conductor":"Pasajero"})]})]}):e.jsxs("div",{className:"space-y-2 px-4",children:[e.jsx(g,{to:"/login",className:"w-full flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",state:{from:window.location.pathname},onClick:()=>t(!1),children:"Iniciar sesión"}),e.jsxs("p",{className:"text-center text-sm text-gray-500",children:["¿No tienes cuenta?"," ",e.jsx(g,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",state:{from:window.location.pathname,register:!0},onClick:()=>t(!1),children:"Regístrate"})]})]}),r&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx(g,{to:"/profile",className:"block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100",onClick:()=>t(!1),children:"Mi perfil"}),e.jsxs("button",{onClick:()=>{i(),t(!1)},className:"w-full text-left px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100 flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Cerrar sesión"]})]})]})]})]})}Ie();const _e=j.lazy(()=>I(()=>import("./Login.mc6rHNb8.js"),__vite__mapDeps([0,1,2,3,4,5]))),Te=j.lazy(()=>I(()=>import("./LandingPage.D5P-A-qm.js"),__vite__mapDeps([6,1,2,3,4,5]))),qe=j.lazy(()=>I(()=>import("./Passenger.BdG7N9e5.js"),__vite__mapDeps([7,1,2,3,4,5]))),Fe=j.lazy(()=>I(()=>import("./Driver.B3XppC9J.js"),__vite__mapDeps([8,1,2,3,4,5]))),Me=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando..."})]})}),Be=()=>{const{pathname:r}=A();return j.useEffect(()=>{window.scrollTo(0,0)},[r]),null},ze=()=>{var t;const{currentUser:r}=O(),n=A();if((t=n.state)!=null&&t.from)return e.jsx(L,{to:n.state.from,replace:!0});const s=(r==null?void 0:r.role)==="driver"?"/driver":"/passenger";return e.jsx(L,{to:s,replace:!0})};function S({children:r}){return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(Oe,{}),e.jsx("main",{className:"flex-grow",children:r}),e.jsx("footer",{className:"bg-gray-800 text-white py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"text-center",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," TransportApp. Todos los derechos reservados."]})})})})]})}function Ve({children:r}){var t,a;const{currentUser:n}=O(),s=A();if(n){const i=((a=(t=s.state)==null?void 0:t.from)==null?void 0:a.pathname)||(n.role==="driver"?"/driver":"/passenger");return e.jsx(L,{to:i,state:{from:s},replace:!0})}return r}function Ge(){return e.jsxs(me,{basename:"/",children:[e.jsx(Be,{}),e.jsx(j.Suspense,{fallback:e.jsx(Me,{}),children:e.jsxs(pe,{children:[e.jsx(k,{path:"/",element:e.jsx(S,{children:e.jsx(Te,{})})}),e.jsx(k,{path:"/login",element:e.jsx(Ve,{children:e.jsx(_e,{})})}),e.jsx(k,{path:"/passenger/*",element:e.jsx(M,{children:e.jsx(S,{children:e.jsx(qe,{})})})}),e.jsx(k,{path:"/driver/*",element:e.jsx(M,{roles:["driver"],children:e.jsx(S,{children:e.jsx(Fe,{})})})}),e.jsx(k,{path:"/app",element:e.jsx(M,{children:e.jsx(ze,{})})}),e.jsx(k,{path:"*",element:e.jsx(S,{children:e.jsx(L,{to:"/",replace:!0})})})]})})]})}const ee=document.getElementById("root");ee&&ue(ee).render(e.jsx(j.StrictMode,{children:e.jsx(De,{children:e.jsx(Ge,{})})}));export{Xe as a,Ye as b,He as c,b as d,Qe as g,Ke as s,O as u};
